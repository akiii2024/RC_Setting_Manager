# 天気API設定ガイド

このアプリでは、現在地の気温と湿度を自動的に取得するためにOpenWeatherMap APIを使用しています。

## APIキーの取得方法

1. [OpenWeatherMap](https://openweathermap.org/api)にアクセス
2. アカウントを作成（無料）
3. API Keysページでキーを取得
4. 無料プランでは1日1000回まで利用可能

## APIキーの設定方法

### 方法1: ソースコードに直接設定（開発用）

`lib/services/weather_service.dart`ファイルの以下の行を編集：

```dart
static const String _apiKey = 'YOUR_API_KEY_HERE';
```

を

```dart
static const String _apiKey = 'あなたのAPIキー';
```

に変更してください。

### 方法2: 環境変数を使用（本番用推奨）

1. プロジェクトルートに`.env`ファイルを作成
2. 以下の内容を追加：
```
OPENWEATHER_API_KEY=あなたのAPIキー
```

3. `pubspec.yaml`に`flutter_dotenv`パッケージを追加
4. `weather_service.dart`を修正して環境変数から読み込み

## APIキーが設定されていない場合

APIキーが設定されていない場合、アプリは以下のようになります：

- **自動的にモックデータを使用**: 気温25℃、湿度60%のサンプルデータが自動入力されます
- **視覚的な表示**: 天気情報カードがオレンジ色で表示され、「サンプル天気データ」と表示されます
- **警告アイコン**: 雲アイコンの代わりに警告アイコンが表示されます
- **説明メッセージ**: 「APIキーが未設定または無効です」というメッセージが表示されます
- **手動入力も可能**: 必要に応じて手動で値を変更できます

## エラー対応の改善

401エラー（認証エラー）が発生した場合：

1. **自動フォールバック**: エラーを検出すると自動的にモックデータに切り替わります
2. **詳細なログ出力**: コンソールに詳細なエラー情報が表示されます
3. **ユーザーフレンドリーな表示**: エラーが発生してもアプリは正常に動作し続けます

## 機能

- **自動取得**: 現在位置の気温と湿度を自動取得
- **手動更新**: 雲アイコンをタップして最新の天気情報を取得
- **視覚的表示**: 基本設定タブに現在の天気情報を表示
- **フォールバック**: APIが利用できない場合は手動入力

## 注意事項

- 位置情報の権限が必要です
- インターネット接続が必要です
- APIの利用制限にご注意ください（無料プランは1日1000回）
- APIキーは公開しないでください

## トラブルシューティング

### 天気情報が取得できない場合

1. インターネット接続を確認
2. 位置情報の権限を確認
3. APIキーが正しく設定されているか確認
4. API利用制限に達していないか確認

### エラーメッセージ

- `天気APIキーが設定されていません`: APIキーを設定してください
- `位置情報を取得できませんでした`: 位置情報の権限を許可してください
- `天気情報取得エラー`: ネットワーク接続やAPI制限を確認してください